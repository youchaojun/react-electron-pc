{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/youn/Documents/younFolder/Demo/react-electron-pc/src/components/Menu/SubMenuLeft.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Layout, Menu } from 'antd';\nimport { Link, useLocation } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\nimport { menuRouter } from '@/routers/menuRouter';\nimport IconFont from '../IconFont';\nconst {\n  SubMenu\n} = Menu;\nconst {\n  Sider\n} = Layout;\n\nconst SubMenuLeft = () => {\n  _s();\n\n  const result = useSelector(state => state.publicReducer);\n  const resUser = useSelector(state => state.loginReducer);\n  const userInfo = resUser.userInfo;\n  const menuTabList = result.menuTab;\n  const currentTabIndex = result.currentTabIndex;\n  const location = useLocation();\n  const [openKey, setOpenKey] = useState('0');\n  const [selectKey, setSelectKey] = useState('0');\n  const historyPath = location.pathname;\n  const siderRouter = menuRouter[currentTabIndex].children;\n  const recursionFind = useCallback(() => {\n    for (let val of siderRouter) {\n      if (val.path === historyPath) {\n        setKey(val);\n      } else {\n        for (let item of val.children) {\n          if (item.path === historyPath) {\n            setKey(item);\n          }\n        }\n      }\n    }\n  }, [historyPath, siderRouter]);\n  useEffect(() => {\n    // 循环查找path的菜单的id\n    recursionFind();\n  }, [menuTabList, recursionFind]);\n\n  const setKey = val => {\n    const stringRes = String(val.id); // 需要更改成查找当前的父级的id（展开的id为父级的id）\n\n    if (val.parentId) {\n      setOpenKey(val.parentId.toString());\n    }\n\n    setSelectKey(stringRes);\n  };\n  /**\n   * 菜单权限处理\n   * @routerConfig 路由配置\n   */\n\n\n  const filterAuthority = () => {\n    const permissions = userInfo.currentPermissions;\n    /** 添加一个parentId用于展开菜单用 */\n\n    let idNumber = 0; // 处理一级菜单是否有权限\n\n    for (let val of siderRouter) {\n      idNumber++;\n\n      if (permissions.some(authorityOuter => val.authority.includes(authorityOuter))) {\n        val.show = true;\n        val.id = idNumber;\n      } else {\n        val.id = idNumber;\n        val.show = false;\n      }\n\n      let parentId = idNumber; // 处理二级菜单是否有权限\n\n      for (let valChildren of val.children) {\n        idNumber++;\n\n        if (permissions.some(authorityInner => valChildren.authority.includes(authorityInner))) {\n          valChildren.id = idNumber;\n          valChildren.parentId = parentId;\n          valChildren.show = true; // 如果子菜单中有显示的菜单，则父级菜单也显示\n\n          val.show = true;\n        } else {\n          valChildren.id = idNumber;\n          valChildren.parentId = parentId;\n          valChildren.show = false;\n        }\n      }\n    }\n\n    return siderRouter;\n  };\n  /**\n   *一级菜单\n   @val \n   */\n\n\n  function firstMenu(val) {\n    return val.show ? /*#__PURE__*/_jsxDEV(Menu.Item, {\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: val.path,\n        children: [/*#__PURE__*/_jsxDEV(IconFont, {\n          type: val.icon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: val.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this)\n    }, `${val.id}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this) : null;\n  }\n  /**\n   *二级菜单\n   @val 二级菜单\n   */\n\n\n  function secondMenu(val) {\n    return val.show ? /*#__PURE__*/_jsxDEV(SubMenu, {\n      title: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(IconFont, {\n          type: val.icon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: val.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true),\n      children: secondInnerMenu(val.children)\n    }, `${val.id}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this) : null;\n  }\n  /**\n   *二级菜单子菜单\n   @children 子菜单 \n   */\n\n\n  function secondInnerMenu(children) {\n    return children.map(v => v.show ? /*#__PURE__*/_jsxDEV(Menu.Item, {\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: v.path,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: v.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }, this)\n    }, `${v.id}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }, this) : null);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Sider, {\n    className: \"menu-sider\",\n    id: \"menuSider\",\n    width: \"140\",\n    children: /*#__PURE__*/_jsxDEV(Menu, {\n      onOpenChange: openKeys => setOpenKey(String(openKeys[1])),\n      theme: \"dark\",\n      onClick: ({\n        key\n      }) => setSelectKey(String(key)),\n      openKeys: [openKey],\n      selectedKeys: [selectKey],\n      defaultSelectedKeys: ['0'],\n      mode: \"inline\",\n      children: filterAuthority().map(val => {\n        return val.path !== '' ? firstMenu(val) : secondMenu(val);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SubMenuLeft, \"y82Sz+VKIlTSRsFPC4jcvvam8bE=\", false, function () {\n  return [useSelector, useSelector, useLocation];\n});\n\n_c = SubMenuLeft;\nexport default SubMenuLeft;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubMenuLeft\");","map":{"version":3,"sources":["/Users/youn/Documents/younFolder/Demo/react-electron-pc/src/components/Menu/SubMenuLeft.tsx"],"names":["React","useState","useEffect","useCallback","Layout","Menu","Link","useLocation","useSelector","menuRouter","IconFont","SubMenu","Sider","SubMenuLeft","result","state","publicReducer","resUser","loginReducer","userInfo","menuTabList","menuTab","currentTabIndex","location","openKey","setOpenKey","selectKey","setSelectKey","historyPath","pathname","siderRouter","children","recursionFind","val","path","setKey","item","stringRes","String","id","parentId","toString","filterAuthority","permissions","currentPermissions","idNumber","some","authorityOuter","authority","includes","show","valChildren","authorityInner","firstMenu","icon","name","secondMenu","secondInnerMenu","map","v","openKeys","key"],"mappings":"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","sourcesContent":["import React, { FC, ReactNode, useState, useEffect, useCallback } from 'react';\nimport { Layout, Menu } from 'antd';\nimport { Link, useLocation } from 'react-router-dom';\nimport { MenuRoutersIF } from '@/typings/router';\nimport { useSelector } from 'react-redux';\nimport { LoginReducerIF, PublicReducerIF } from '@/store/reducers';\nimport { PublicStateIF } from '@/store/states/public';\nimport { menuRouter } from '@/routers/menuRouter';\nimport IconFont from '../IconFont';\nimport { LoginStateIF } from '@/store/states';\nconst { SubMenu } = Menu;\nconst { Sider } = Layout;\n\nconst SubMenuLeft: FC = () => {\n  const result = useSelector<PublicReducerIF, PublicStateIF>((state) => state.publicReducer);\n  const resUser = useSelector<LoginReducerIF, LoginStateIF>((state) => state.loginReducer);\n  const userInfo = resUser.userInfo;\n  const menuTabList = result.menuTab;\n  const currentTabIndex = result.currentTabIndex;\n  const location = useLocation();\n  const [openKey, setOpenKey] = useState<string>('0');\n  const [selectKey, setSelectKey] = useState<string>('0');\n  const historyPath = location.pathname;\n  const siderRouter = menuRouter[currentTabIndex].children;\n\n  const recursionFind = useCallback((): void => {\n    for (let val of siderRouter) {\n      if (val.path === historyPath) {\n        setKey(val);\n      } else {\n        for (let item of val.children) {\n          if (item.path === historyPath) {\n            setKey(item);\n          }\n        }\n      }\n    }\n  }, [historyPath, siderRouter]);\n\n  useEffect(() => {\n    // 循环查找path的菜单的id\n    recursionFind();\n  }, [menuTabList, recursionFind]);\n\n  const setKey = (val: MenuRoutersIF) => {\n    const stringRes = String(val.id);\n    // 需要更改成查找当前的父级的id（展开的id为父级的id）\n    if (val.parentId) {\n      setOpenKey(val.parentId.toString());\n    }\n    setSelectKey(stringRes);\n  };\n  /**\n   * 菜单权限处理\n   * @routerConfig 路由配置\n   */\n  const filterAuthority = (): MenuRoutersIF[] => {\n    const permissions = userInfo.currentPermissions;\n    /** 添加一个parentId用于展开菜单用 */\n    let idNumber = 0;\n    // 处理一级菜单是否有权限\n    for (let val of siderRouter) {\n      idNumber++;\n      if (permissions.some((authorityOuter) => val.authority.includes(authorityOuter))) {\n        val.show = true;\n        val.id = idNumber;\n      } else {\n        val.id = idNumber;\n        val.show = false;\n      }\n      let parentId = idNumber;\n      // 处理二级菜单是否有权限\n      for (let valChildren of val.children) {\n        idNumber++;\n        if (permissions.some((authorityInner) => valChildren.authority.includes(authorityInner))) {\n          valChildren.id = idNumber;\n          valChildren.parentId = parentId;\n          valChildren.show = true;\n          // 如果子菜单中有显示的菜单，则父级菜单也显示\n          val.show = true;\n        } else {\n          valChildren.id = idNumber;\n          valChildren.parentId = parentId;\n          valChildren.show = false;\n        }\n      }\n    }\n    return siderRouter;\n  };\n\n  /**\n   *一级菜单\n   @val \n   */\n  function firstMenu(val: MenuRoutersIF): ReactNode {\n    return val.show ? (\n      <Menu.Item key={`${val.id}`}>\n        <Link to={val.path}>\n          <IconFont type={val.icon!} />\n          <span>{val.name}</span>\n        </Link>\n      </Menu.Item>\n    ) : null;\n  }\n  /**\n   *二级菜单\n   @val 二级菜单\n   */\n  function secondMenu(val: MenuRoutersIF): ReactNode {\n    return val.show ? (\n      <SubMenu\n        key={`${val.id}`}\n        title={\n          <>\n            <IconFont type={val.icon!} />\n            <span>{val.name}</span>\n          </>\n        }\n      >\n        {secondInnerMenu(val.children)}\n      </SubMenu>\n    ) : null;\n  }\n  /**\n   *二级菜单子菜单\n   @children 子菜单 \n   */\n  function secondInnerMenu(children: MenuRoutersIF[]): ReactNode {\n    return children.map((v: MenuRoutersIF) =>\n      v.show ? (\n        <Menu.Item key={`${v.id}`}>\n          <Link to={v.path}>\n            <span>{v.name}</span>\n          </Link>\n        </Menu.Item>\n      ) : null\n    );\n  }\n\n  return (\n    <Sider className=\"menu-sider\" id=\"menuSider\" width=\"140\">\n      <Menu\n        onOpenChange={(openKeys: (string | number)[]) => setOpenKey(String(openKeys[1]))}\n        theme=\"dark\"\n        onClick={({ key }: { key: string | number }) => setSelectKey(String(key))}\n        openKeys={[openKey]}\n        selectedKeys={[selectKey]}\n        defaultSelectedKeys={['0']}\n        mode=\"inline\"\n      >\n        {filterAuthority().map((val) => {\n          return val.path !== '' ? firstMenu(val) : secondMenu(val);\n        })}\n      </Menu>\n    </Sider>\n  );\n};\n\nexport default SubMenuLeft;\n"]},"metadata":{},"sourceType":"module"}